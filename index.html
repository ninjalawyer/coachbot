<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanctuary - Personal Wellness Companion</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cream: #faf7f2;
            --warm-white: #ffffff;
            --sage: #9ca998;
            --deep-sage: #6b7b65;
            --charcoal: #2d2d2d;
            --gold: #d4af37;
            --shadow: rgba(45, 45, 45, 0.08);
            --shadow-heavy: rgba(45, 45, 45, 0.15);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #f5f2ed 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--charcoal);
            line-height: 1.6;
        }

        .app-container {
            background: var(--warm-white);
            border-radius: 0;
            box-shadow: 0 40px 80px var(--shadow-heavy), 0 20px 40px var(--shadow);
            width: 100%;
            max-width: 480px;
            height: 85vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .app-header {
            background: var(--warm-white);
            padding: 40px 32px 24px;
            border-bottom: 1px solid rgba(156, 169, 152, 0.15);
            position: relative;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .app-title {
            font-size: 28px;
            font-weight: 300;
            color: var(--charcoal);
            text-align: center;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .app-subtitle {
            font-size: 14px;
            color: var(--sage);
            text-align: center;
            font-weight: 400;
            opacity: 0.8;
        }

        .conversation-area {
            flex: 1;
            padding: 0;
            overflow-y: auto;
            background: var(--warm-white);
            position: relative;
        }

        .conversation-area::-webkit-scrollbar {
            width: 2px;
        }

        .conversation-area::-webkit-scrollbar-track {
            background: transparent;
        }

        .conversation-area::-webkit-scrollbar-thumb {
            background: var(--sage);
            border-radius: 2px;
        }

        .message {
            margin: 0;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(156, 169, 152, 0.08);
            animation: messageSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes messageSlide {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .message.assistant {
            background: linear-gradient(135deg, #fafafa 0%, var(--warm-white) 100%);
        }

        .message.user {
            background: var(--warm-white);
            text-align: right;
        }

        .message-content {
            font-size: 16px;
            line-height: 1.7;
            font-weight: 400;
            max-width: none;
        }

        .message.assistant .message-content {
            color: var(--charcoal);
        }

        .message.user .message-content {
            color: var(--deep-sage);
            font-weight: 500;
        }

        .input-section {
            padding: 32px;
            background: var(--warm-white);
            border-top: 1px solid rgba(156, 169, 152, 0.15);
            position: relative;
        }

        .input-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 32px;
            right: 32px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--sage), transparent);
            opacity: 0.3;
        }

        .input-container {
            display: flex;
            align-items: flex-end;
            gap: 16px;
        }

        .input-field {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 16px;
            color: var(--charcoal);
            placeholder-color: var(--sage);
            padding: 0;
            resize: none;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
            min-height: 24px;
            max-height: 120px;
        }

        .input-field::placeholder {
            color: var(--sage);
            font-weight: 400;
        }

        .send-button {
            background: var(--charcoal);
            color: var(--warm-white);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
            flex-shrink: 0;
        }

        .send-button:hover {
            background: var(--deep-sage);
            transform: scale(1.05);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .quick-prompts {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .quick-prompts::-webkit-scrollbar {
            height: 2px;
        }

        .quick-prompts::-webkit-scrollbar-track {
            background: transparent;
        }

        .quick-prompts::-webkit-scrollbar-thumb {
            background: var(--sage);
            border-radius: 2px;
        }

        .quick-prompt {
            background: transparent;
            color: var(--sage);
            border: 1px solid rgba(156, 169, 152, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 400;
        }

        .quick-prompt:hover {
            border-color: var(--sage);
            color: var(--deep-sage);
            background: rgba(156, 169, 152, 0.05);
        }

        .status-indicator {
            position: fixed;
            top: 24px;
            right: 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--sage);
            box-shadow: 0 8px 32px var(--shadow);
            z-index: 1000;
            font-weight: 500;
        }

        .thinking-indicator {
            display: none;
            padding: 24px 32px;
            color: var(--sage);
            font-style: italic;
            font-size: 14px;
            background: linear-gradient(135deg, #fafafa 0%, var(--warm-white) 100%);
            border-bottom: 1px solid rgba(156, 169, 152, 0.08);
        }

        .thinking-dots {
            display: inline-flex;
            gap: 4px;
            margin-left: 8px;
        }

        .thinking-dot {
            width: 4px;
            height: 4px;
            background: var(--sage);
            border-radius: 50%;
            animation: thinking 1.8s infinite ease-in-out;
        }

        .thinking-dot:nth-child(2) { animation-delay: 0.3s; }
        .thinking-dot:nth-child(3) { animation-delay: 0.6s; }

        @keyframes thinking {
            0%, 80%, 100% { 
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .welcome-message {
            padding: 40px 32px;
            text-align: center;
            color: var(--sage);
            background: linear-gradient(135deg, #fafafa 0%, var(--warm-white) 100%);
            border-bottom: 1px solid rgba(156, 169, 152, 0.08);
        }

        .welcome-message h2 {
            font-size: 18px;
            font-weight: 500;
            color: var(--charcoal);
            margin-bottom: 12px;
            letter-spacing: 0.3px;
        }

        .welcome-message p {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.8;
            margin-bottom: 16px;
        }

        .privacy-notice {
            font-size: 11px;
            color: var(--sage);
            opacity: 0.6;
            line-height: 1.4;
            margin-top: 20px;
        }

        .crisis-notice {
            background: rgba(212, 175, 55, 0.08);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin: 20px 32px;
            font-size: 12px;
            color: var(--charcoal);
            text-align: center;
            line-height: 1.5;
        }

        .crisis-notice strong {
            color: var(--gold);
            font-weight: 600;
        }

        .floating-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            pointer-events: none;
            z-index: -1;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(212, 175, 55, 0.8), rgba(156, 169, 152, 0.4));
            animation: float 15s infinite linear;
        }

        .orb:nth-child(1) {
            width: 100px;
            height: 100px;
            top: 20%;
            left: -50px;
            animation-delay: 0s;
        }

        .orb:nth-child(2) {
            width: 140px;
            height: 140px;
            top: 60%;
            left: -70px;
            animation-delay: -5s;
        }

        .orb:nth-child(3) {
            width: 80px;
            height: 80px;
            top: 40%;
            left: -40px;
            animation-delay: -10s;
        }

        @keyframes float {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateX(calc(100vw + 200px)) translateY(-100px);
                opacity: 0;
            }
        }

        .breathing-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(212, 175, 55, 0.8) 50%, 
                transparent 100%);
            animation: breathe 4s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes breathe {
            0%, 100% {
                opacity: 0.6;
                transform: scaleX(0.5);
            }
            50% {
                opacity: 1;
                transform: scaleX(1.5);
            }
        }

        .app-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(156, 169, 152, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(212, 175, 55, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: pulse 10s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
        }

        .message {
            margin: 0;
            padding: 24px 32px;
            border-bottom: 1px solid rgba(156, 169, 152, 0.08);
            animation: messageSlide 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .message::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            animation: shimmer 2s ease-in-out;
            animation-delay: 0.5s;
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        .app-header,
        .conversation-area,
        .input-section {
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .app-container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }
            
            .app-header {
                padding: 32px 24px 20px;
            }
            
            .message {
                padding: 20px 24px;
            }
            
            .input-section {
                padding: 24px;
            }
            
            .status-indicator {
                top: 16px;
                right: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="floating-orbs">
            <div class="orb"></div>
            <div class="orb"></div>
            <div class="orb"></div>
        </div>
        
        <div class="breathing-glow"></div>
        
        <div class="app-header">
            <h1 class="app-title">Sanctuary</h1>
            <p class="app-subtitle">Personal wellness companion â€¢ Beta</p>
        </div>
        
        <div class="conversation-area" id="conversationArea">
            <div class="welcome-message">
                <h2>Welcome to your space</h2>
                <p>I'm here to listen without judgment and help you navigate whatever you're experiencing. What's on your mind today?</p>
                
                <div class="privacy-notice">
                    Conversations use AI processing through secure third-party services. No personal information is collected, and conversations aren't permanently stored.
                </div>
            </div>
            
            <div class="crisis-notice">
                <strong>Important:</strong> This is a wellness companion, not a replacement for professional care. If you're experiencing suicidal thoughts or a mental health crisis, please contact a counselor or call 911 immediately.
            </div>
            
            <div class="thinking-indicator" id="thinkingIndicator">
                Reflecting on your words
                <div class="thinking-dots">
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                </div>
            </div>
        </div>
        
        <div class="input-section">
            <div class="quick-prompts">
                <button class="quick-prompt" onclick="useQuickPrompt('I\'ve been feeling anxious lately')">Feeling anxious</button>
                <button class="quick-prompt" onclick="useQuickPrompt('I had a difficult day')">Difficult day</button>
                <button class="quick-prompt" onclick="useQuickPrompt('I feel overwhelmed')">Overwhelmed</button>
                <button class="quick-prompt" onclick="useQuickPrompt('I need some perspective')">Need perspective</button>
            </div>
            
            <div class="input-container">
                <textarea 
                    id="messageInput" 
                    class="input-field" 
                    placeholder="Share what's on your mind..."
                    rows="1"
                    maxlength="500"
                ></textarea>
                <button class="send-button" onclick="sendMessage()" id="sendButton">
                    â†’
                </button>
            </div>
        </div>
    </div>

    <div class="status-indicator" id="statusIndicator">
        AI-Enhanced Conversations
    </div>

    <script>
        class SanctuaryBot {
            constructor() {
                this.conversationHistory = [];
                this.sessionMessages = 0;
                this.apiCallCount = parseInt(localStorage.getItem('sanctuaryApiCalls') || '0');
                this.maxDailyApiCalls = 50;
                this.lastApiReset = localStorage.getItem('sanctuaryApiReset') || new Date().toDateString();
                
                // Reset API counter if new day
                if (this.lastApiReset !== new Date().toDateString()) {
                    this.apiCallCount = 0;
                    this.lastApiReset = new Date().toDateString();
                    localStorage.setItem('sanctuaryApiCalls', '0');
                    localStorage.setItem('sanctuaryApiReset', this.lastApiReset);
                }
                
                // Hugging Face API configuration
                this.apiUrl = 'https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium';
                this.apiKey = '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';
                
                // Therapeutic context for AI responses
                this.therapeuticContext = `You are Sanctuary, a sophisticated mental health companion. Respond with:
                - Deep empathy and validation
                - Evidence-based insights from psychology
                - Thoughtful follow-up questions
                - Practical, gentle guidance
                - Professional warmth without being clinical
                Keep responses conversational, insightful, and under 120 words.
                
                Context: `;
                
                // Curated therapeutic responses for fallback
                this.therapeuticPatterns = {
                    anxiety: {
                        triggers: ['anxious', 'worry', 'nervous', 'panic', 'stressed', 'overwhelmed'],
                        responses: [
                            "Anxiety often signals that something matters deeply to you. What specifically is weighing on your mind right now?",
                            "I hear the worry in your words. Sometimes our minds create stories about the future. What evidence do you have that challenges your most feared outcome?",
                            "Anxiety can feel all-consuming, but you've navigated difficult feelings before. What has helped ground you in the past?"
                        ]
                    },
                    sadness: {
                        triggers: ['sad', 'depressed', 'down', 'hurt', 'empty', 'hopeless', 'crying'],
                        responses: [
                            "Your pain is real and valid. Sadness often reflects how much something mattered to you. What are you grieving right now?",
                            "It takes courage to sit with difficult emotions. What would you need to feel even slightly more supported in this moment?",
                            "Sometimes sadness is how we honor what we've lost or what we hoped for. What story is your sadness trying to tell you?"
                        ]
                    },
                    anger: {
                        triggers: ['angry', 'furious', 'frustrated', 'irritated', 'mad', 'rage'],
                        responses: [
                            "Anger often protects something vulnerable underneath. What boundary or value feels threatened right now?",
                            "That frustration sounds intense. What would it look like to honor that feeling while also caring for yourself?",
                            "Your anger is information. What is it trying to tell you about what you need or what matters to you?"
                        ]
                    },
                    relationships: {
                        triggers: ['relationship', 'partner', 'friend', 'family', 'conflict', 'fight', 'hurt by'],
                        responses: [
                            "Relationships can hold our deepest joys and most profound hurts. What are you hoping for in this situation?",
                            "It sounds like this relationship means something significant to you. What would healing look like here?",
                            "Human connection is complex. What do you think the other person might not understand about your experience?"
                        ]
                    }
                };
                
                this.updateStatusIndicator();
            }
            
            async generateResponse(userMessage) {
                this.conversationHistory.push({ role: 'user', content: userMessage });
                this.sessionMessages++;
                
                // Try AI response if within limits
                if (this.apiCallCount < this.maxDailyApiCalls) {
                    try {
                        const aiResponse = await this.getAIResponse(userMessage);
                        if (aiResponse) {
                            this.apiCallCount++;
                            localStorage.setItem('sanctuaryApiCalls', this.apiCallCount.toString());
                            this.updateStatusIndicator();
                            return aiResponse;
                        }
                    } catch (error) {
                        console.log('AI response failed, using therapeutic fallback');
                    }
                }
                
                // Fallback to therapeutic patterns
                return this.getTherapeuticResponse(userMessage);
            }
            
            async getAIResponse(userMessage) {
                const context = this.buildConversationContext(userMessage);
                
                console.log('Attempting API call with key:', this.apiKey ? 'Key present' : 'No key');
                console.log('API calls used:', this.apiCallCount, '/', this.maxDailyApiCalls);
                
                try {
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            inputs: context + userMessage,
                            parameters: {
                                max_length: 100,
                                temperature: 0.8,
                                do_sample: true,
                                top_p: 0.9
                            }
                        })
                    });
                    
                    console.log('API Response status:', response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('API Error:', response.status, errorText);
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('API Response data:', data);
                    
                    if (data && data.length > 0 && data[0].generated_text) {
                        const fullText = data[0].generated_text;
                        // Extract only the new response part
                        const newResponse = fullText.replace(context + userMessage, '').trim();
                        return this.refineAIResponse(newResponse);
                    }
                    
                    console.log('No generated text in response');
                    return null;
                } catch (error) {
                    console.error('AI API error:', error);
                    return null;
                }
            }
            
            buildConversationContext(currentMessage) {
                const recentContext = this.conversationHistory
                    .slice(-2)
                    .map(m => m.content)
                    .join(' ');
                return this.therapeuticContext + recentContext + '\n\nUser: ';
            }
            
            refineAIResponse(rawResponse) {
                let response = rawResponse.trim();
                
                // Ensure appropriate length
                if (response.length > 200) {
                    response = response.substring(0, 200) + '...';
                }
                
                // Add therapeutic elements if missing
                if (!response.includes('?') && Math.random() > 0.6) {
                    const therapeuticQuestions = [
                        " What feels most important about this to you?",
                        " How are you taking care of yourself through this?",
                        " What would self-compassion look like here?",
                        " What support do you have available?"
                    ];
                    response += therapeuticQuestions[Math.floor(Math.random() * therapeuticQuestions.length)];
                }
                
                return response;
            }
            
            getTherapeuticResponse(userMessage) {
                const message = userMessage.toLowerCase();
                
                // Find matching therapeutic pattern
                for (const [category, pattern] of Object.entries(this.therapeuticPatterns)) {
                    const hasMatch = pattern.triggers.some(trigger => message.includes(trigger));
                    if (hasMatch) {
                        const responses = pattern.responses;
                        return responses[Math.floor(Math.random() * responses.length)];
                    }
                }
                
                // Generic therapeutic responses
                const genericResponses = [
                    "I'm here with you in this moment. What feels most present for you right now?",
                    "Thank you for trusting me with this. What would it mean to you to feel heard about this?",
                    "Your experience matters. What's the most difficult part of what you're going through?",
                    "I sense this is weighing on you. What kind of support would feel most helpful right now?",
                    "There's wisdom in what you're feeling. What is your inner voice telling you about this situation?"
                ];
                
                return genericResponses[Math.floor(Math.random() * genericResponses.length)];
            }
            
            updateStatusIndicator() {
                const indicator = document.getElementById('statusIndicator');
                const remaining = this.maxDailyApiCalls - this.apiCallCount;
                
                if (remaining > 10) {
                    indicator.textContent = 'AI-Enhanced Conversations';
                } else if (remaining > 0) {
                    indicator.textContent = `AI Mode (${remaining} left today)`;
                } else {
                    indicator.textContent = 'Therapeutic Mode';
                }
            }
        }

        // Initialize Sanctuary
        const sanctuary = new SanctuaryBot();

        function addMessage(content, isUser = false) {
            const conversationArea = document.getElementById('conversationArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            conversationArea.appendChild(messageDiv);
            
            // Smooth scroll to bottom
            conversationArea.scrollTo({
                top: conversationArea.scrollHeight,
                behavior: 'smooth'
            });
        }

        function showThinking() {
            document.getElementById('thinkingIndicator').style.display = 'block';
        }

        function hideThinking() {
            document.getElementById('thinkingIndicator').style.display = 'none';
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            input.style.height = 'auto';
            
            // Show thinking state
            showThinking();
            
            try {
                // Generate response with realistic delay
                const response = await sanctuary.generateResponse(message);
                
                // Simulate thoughtful processing time
                await new Promise(resolve => setTimeout(resolve, 1200 + Math.random() * 800));
                
                hideThinking();
                addMessage(response);
                
            } catch (error) {
                hideThinking();
                addMessage("I'm having trouble processing that right now. Could you try rephrasing your thoughts?");
                console.error('Response generation error:', error);
            }
        }

        function useQuickPrompt(prompt) {
            document.getElementById('messageInput').value = prompt;
            sendMessage();
        }

        // Auto-resize textarea
        const messageInput = document.getElementById('messageInput');
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Send on Enter (but allow Shift+Enter for new lines)
        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Focus input on load
        window.addEventListener('load', () => {
            messageInput.focus();
            
            // Focus input on load and add debug info
            setTimeout(() => {
                console.log('Sanctuary initialized');
                console.log('API Key present:', sanctuary.apiKey ? 'Yes' : 'No');
                console.log('API calls used today:', sanctuary.apiCallCount);
                
                // Add a debug message showing current mode
                const debugMode = sanctuary.apiCallCount < sanctuary.maxDailyApiCalls ? 'AI Mode Active' : 'Offline Mode';
                addMessage(`ðŸ”§ DEBUG: ${debugMode} - API calls: ${sanctuary.apiCallCount}/${sanctuary.maxDailyApiCalls}`);
            }, 1500);
        });
    </script>
</body>
</html>
